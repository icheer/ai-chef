<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ³ æ™ºèƒ½é£Ÿè°±ç”Ÿæˆå™¨</title>
  
  <!-- CDNèµ„æºå¼•å…¥ -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/sweetalert2@11"></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  <!-- ä½¿ç”¨æ¸…ç†åçš„æ ·å¼æ–‡ä»¶ï¼Œå¦‚éœ€å›æ»šå¯æ”¹å› styles.css -->
  <link rel="stylesheet" href="./styles.css?v=1">
</head>
<body>
  <div id="app">
    <!-- åº”ç”¨æ ‡é¢˜ -->
    <header class="app-header">
      <h1>ğŸ³ æ™ºèƒ½é£Ÿè°±ç”Ÿæˆå™¨</h1>
      <p class="subtitle">è¾“å…¥ç°æœ‰é£Ÿæï¼ŒAIä¸ºæ‚¨ç”Ÿæˆåˆ›æ„é£Ÿè°±</p>
      <div class="save-status" v-if="lastSaveTime">
        <small>{{ lastSaveText }}</small>
      </div>
    </header>

    <!-- ç”¨æˆ·æ¡£æ¡ˆåŒºåŸŸ -->
    <section class="user-profile">
      <h2>ğŸ‘¤ ç”¨æˆ·æ¡£æ¡ˆ</h2>
      <div class="profile-form">
        <div class="form-row">
          <label>ç”¨é¤äººæ•°:</label>
          <input type="number" v-model.number="userProfile.serving_size" min="1" max="10">
        </div>
        
        <div class="form-row">
          <label>çƒ¹é¥ªæŠ€èƒ½:</label>
          <select v-model="userProfile.cooking_skill">
            <option value="åˆçº§">åˆçº§</option>
            <option value="ä¸­çº§">ä¸­çº§</option>
            <option value="é«˜çº§">é«˜çº§</option>
          </select>
        </div>
        
        <div class="form-row">
          <label>å¯ç”¨æ—¶é—´:</label>
          <input type="number" v-model.number="userProfile.time_available" min="5" max="180">
          <span class="unit">åˆ†é’Ÿ</span>
        </div>

        <div class="form-row">
          <label>èœç³»åå¥½:</label>
          <select v-model="userProfile.cuisine_preferences" multiple>
            <option value="ä¸­å¼">ä¸­å¼</option>
            <option value="è¥¿å¼">è¥¿å¼</option>
            <option value="æ—¥å¼">æ—¥å¼</option>
            <option value="éŸ©å¼">éŸ©å¼</option>
            <option value="ä¸œå—äºš">ä¸œå—äºš</option>
          </select>
        </div>

        <div class="form-row">
          <label>è¾£åº¦æ‰¿å—:</label>
          <select v-model="userProfile.spice_tolerance">
            <option value="ä¸è¾£">ä¸è¾£</option>
            <option value="å¾®è¾£">å¾®è¾£</option>
            <option value="ä¸­è¾£">ä¸­è¾£</option>
            <option value="é‡è¾£">é‡è¾£</option>
          </select>
        </div>
      </div>
    </section>

    <!-- é¥®é£Ÿé™åˆ¶åŒºåŸŸ -->
    <section class="dietary-restrictions">
      <h3>ğŸš« é¥®é£Ÿé™åˆ¶</h3>
      <div class="restrictions-form">
        <div class="form-row">
          <label>è¿‡æ•é£Ÿæ:</label>
          <input type="text" v-model="dietaryRestrictions.allergies" 
                 placeholder="å¦‚ï¼šèŠ±ç”Ÿã€æµ·é²œï¼ˆé€—å·åˆ†éš”ï¼‰">
        </div>
        
        <div class="form-row">
          <label>ä¸è€å—:</label>
          <input type="text" v-model="dietaryRestrictions.intolerances" 
                 placeholder="å¦‚ï¼šä¹³ç³–ã€éº¸è´¨ï¼ˆé€—å·åˆ†éš”ï¼‰">
        </div>
        
        <div class="form-row">
          <label>ä¸å–œæ¬¢çš„é£Ÿæ:</label>
          <input type="text" v-model="dietaryRestrictions.dislikes" 
                 placeholder="å¦‚ï¼šé¦™èœã€è‹¦ç“œï¼ˆé€—å·åˆ†éš”ï¼‰">
        </div>

        <div class="form-row">
          <label>é¥®é£Ÿç±»å‹:</label>
          <select v-model="dietaryRestrictions.diet_type">
            <option value="æ— ç‰¹æ®Šè¦æ±‚">æ— ç‰¹æ®Šè¦æ±‚</option>
            <option value="ç´ é£Ÿ">ç´ é£Ÿ</option>
            <option value="ä½ç¢³æ°´">ä½ç¢³æ°´</option>
            <option value="ç”Ÿé…®">ç”Ÿé…®</option>
            <option value="é«˜è›‹ç™½">é«˜è›‹ç™½</option>
          </select>
        </div>
      </div>
    </section>

    <!-- é£Ÿæé€‰æ‹©åŒºåŸŸ -->
    <section class="ingredient-selection">
      <h2>ğŸ¥˜ é€‰æ‹©é£Ÿæ</h2>
      
      <div class="ingredient-categories">
        <div v-for="(ingredients, category) in ingredientCategories" 
             :key="category" class="category">
          <h4>{{ category }}</h4>
          <div class="ingredient-buttons">
            <button v-for="ingredient in ingredients" 
                    :key="ingredient"
                    @click="addIngredient(ingredient, category)"
                    class="ingredient-btn"
                    :class="{ selected: isIngredientSelected(ingredient) }">
              <span>{{ ingredient }}</span>
            </button>
          </div>
        </div>
      </div>

      <!-- æ‰‹åŠ¨æ·»åŠ é£Ÿæ -->
      <div class="add-custom">
        <input type="text" v-model="customIngredientName" 
               placeholder="è¾“å…¥é£Ÿæåç§°" @keyup.enter="addCustomIngredient">
        <button @click="addCustomIngredient" class="btn-secondary">æ·»åŠ </button>
      </div>
    </section>

    <!-- å·²é€‰é£Ÿæç®¡ç† -->
    <section class="selected-ingredients">
      <h3>âœ… ç°æœ‰é£Ÿæ ({{ ingredientCount }}ç§)</h3>
      
      <div v-if="ingredientCount === 0" class="empty-state">
        è¯·ä»ä¸Šæ–¹é€‰æ‹©é£Ÿæï¼Œæˆ–æ‰‹åŠ¨æ·»åŠ 
      </div>
      
      <div v-else class="ingredients-list">
        <div v-for="(ingredient, index) in selectedIngredients" 
             :key="index" class="ingredient-item">
          <span class="name">{{ ingredient.name }}</span>
          
          <div class="quantity-unit-wrapper">
            <div class="quantity-control">
              <button @click="updateIngredientQuantity(index, ingredient.quantity - 0.5)">-</button>
              <input type="number" v-model.number="ingredient.quantity" 
                     @input="updateIngredientQuantity(index, $event.target.value)"
                     min="0" step="0.1">
              <button @click="updateIngredientQuantity(index, ingredient.quantity + 0.5)">+</button>
            </div>
            
            <select v-model="ingredient.unit">
              <option value="ä¸ª">ä¸ª</option>
              <option value="g">g</option>
              <option value="kg">kg</option>
              <option value="ml">ml</option>
              <option value="L">L</option>
              <option value="èŒ¶åŒ™">èŒ¶åŒ™</option>
              <option value="æ±¤åŒ™">æ±¤åŒ™</option>
            </select>
          </div>
          
          <select v-model="ingredient.freshness">
            <option value="æ–°é²œ">æ–°é²œ</option>
            <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
            <option value="éœ€å°½å¿«ä½¿ç”¨">éœ€å°½å¿«ä½¿ç”¨</option>
          </select>
          
          <button @click="removeIngredient(index)" class="remove-btn"></button>
        </div>
      </div>
    </section>

    <!-- ç”Ÿæˆæ§åˆ¶åŒºåŸŸ -->
    <section class="generation-controls">
      <h3>ğŸ¤– ç”Ÿæˆè®¾ç½®</h3>
      
      <div class="model-selection">
        <label>AIæ¨¡å‹é€‰æ‹©:</label>
        <select v-model="selectedModel">
          <option value="gemini-2.5-flash">Gemini 2.5 Flash (æ¨èï¼Œæ›´å¿«)</option>
          <option value="gemini-2.5-pro">Gemini 2.5 Pro (æ›´å¼ºï¼Œå¯èƒ½ä¸ç¨³å®š)</option>
        </select>
      </div>
      
      <button @click="generateRecipe" 
              :disabled="!formIsValid || isLoading"
              class="generate-btn">
        <span v-if="isLoading">ğŸ”„ ç”Ÿæˆä¸­...</span>
        <span v-else>âœ¨ ç”Ÿæˆé£Ÿè°±</span>
      </button>
      
      <!-- æ•°æ®ç®¡ç†æŒ‰é’® -->
      <div class="data-controls">
        <button @click="clearLocalStorage" class="btn-danger">
          ğŸ—‘ï¸ æ¸…é™¤ä¿å­˜æ•°æ®
        </button>
      </div>
    </section>

    <!-- é£Ÿè°±å±•ç¤ºåŒºåŸŸ (åŠ è½½æˆ–å·²æœ‰ç»“æœéƒ½æ˜¾ç¤ºå®¹å™¨) -->
    <section v-if="showResult || isLoading" class="recipe-result">
      <!-- Loading éª¨æ¶ -->
      <div v-if="isLoading" class="recipe-loading">
        <h3>æ­£åœ¨ç”Ÿæˆ AI é£Ÿè°±...</h3>
        <p>æ ¹æ®æ‚¨çš„é£Ÿæä¸åå¥½æ™ºèƒ½è§„åˆ’èœè°±ï¼Œè¯·ç¨å€™</p>
        <div class="loading-bars">
          <span v-for="n in 5" :key="n" class="bar" :style="{ animationDelay: (n*0.12) + 's' }"></span>
        </div>
      </div>

      <!-- é£Ÿè°±æ¦‚è¦ -->
      <template v-else>
        <header class="recipe-header">
          <h2 class="recipe-title">{{ recipeResult.recipe_name || 'ç¾å‘³é£Ÿè°±' }}</h2>
          <div class="recipe-meta">
            <span class="time">â±ï¸ {{ recipeResult.cooking_time || 30 }}åˆ†é’Ÿ</span>
            <span class="difficulty">ğŸ“Š {{ recipeResult.difficulty || 'ç®€å•' }}</span>
            <span class="servings">ğŸ‘¥ {{ recipeResult.serving_size || userProfile.serving_size }}äººä»½</span>
            <span v-if="recipeResult.cuisine_style" class="cuisine">ğŸ½ï¸ {{ recipeResult.cuisine_style }}</span>
          </div>
          <p class="recipe-description">{{ recipeResult.description || 'ä¸€é“ç¾å‘³çš„å®¶å¸¸èœ' }}</p>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <div class="recipe-actions">
            <button @click="shareRecipe" class="btn-secondary">ğŸ“¤ åˆ†äº«é£Ÿè°±</button>
            <button @click="generateNewRecipe" class="btn-secondary">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
          </div>
        </header>

  <!-- è¥å…»ä¿¡æ¯ -->
  <div v-if="!isLoading && recipeResult.nutrition_info" class="nutrition-section">
        <h3>ğŸ“Š è¥å…»ä¿¡æ¯</h3>
        <div class="nutrition-grid">
          <div class="nutrition-item">
            <span class="label">çƒ­é‡</span>
            <span class="value">{{ recipeResult.nutrition_info.calories_per_serving || 'N/A' }}</span>
          </div>
          <div class="nutrition-item">
            <span class="label">è›‹ç™½è´¨</span>
            <span class="value">{{ recipeResult.nutrition_info.protein || 'N/A' }}</span>
          </div>
          <div class="nutrition-item">
            <span class="label">ç¢³æ°´</span>
            <span class="value">{{ recipeResult.nutrition_info.carbs || 'N/A' }}</span>
          </div>
          <div class="nutrition-item">
            <span class="label">è„‚è‚ª</span>
            <span class="value">{{ recipeResult.nutrition_info.fats || 'N/A' }}</span>
          </div>
        </div>
      </div>

  <!-- æ‰€éœ€é£Ÿæ -->
  <div v-if="!isLoading && recipeResult.ingredients" class="ingredients-section">
        <h3>ğŸ›’ æ‰€éœ€é£Ÿæ</h3>
        <ul class="ingredients-list">
          <li v-for="ingredient in recipeResult.ingredients" :key="ingredient.name" class="ingredient-row">
            <span class="ingredient-amount">{{ ingredient.quantity || ingredient.amount }} {{ ingredient.unit }}</span>
            <span class="ingredient-name">{{ ingredient.name }}</span>
            <span v-if="ingredient.notes || ingredient.role" class="ingredient-notes">({{ ingredient.notes || ingredient.role }})</span>
          </li>
        </ul>
      </div>

  <!-- çƒ¹é¥ªæ­¥éª¤ -->
  <div v-if="!isLoading && recipeResult.cooking_steps" class="cooking-steps-section">
        <h3>ğŸ‘¨â€ğŸ³ çƒ¹é¥ªæ­¥éª¤</h3>
        <div class="steps-container">
          <div v-for="(step, index) in recipeResult.cooking_steps" 
               :key="index" class="cooking-step">
            <div class="step-number">{{ step.step || (index + 1) }}</div>
            <div class="step-content">
              <h4 v-if="step.action" class="step-title">{{ step.action }}</h4>
              <p class="step-instruction">{{ step.description || step.instruction }}</p>
              <p v-if="step.time" class="step-time">â±ï¸ {{ step.time }}</p>
              <p v-if="step.tips" class="step-tip">ğŸ’¡ {{ step.tips }}</p>
            </div>
          </div>
        </div>
      </div>

  <!-- å¨å¸ˆå°è´´å£« -->
  <div v-if="!isLoading && recipeResult.chef_tips && recipeResult.chef_tips.length > 0" class="tips-section">
        <h3>ğŸ‘¨â€ğŸ³ å¨å¸ˆå°è´´å£«</h3>
        <ul class="tips-list">
          <li v-for="tip in recipeResult.chef_tips" :key="tip">{{ tip }}</li>
        </ul>
      </div>

  <!-- å˜åŒ–å»ºè®® -->
  <div v-if="!isLoading && recipeResult.variations && recipeResult.variations.length > 0" class="variations-section">
        <h3>ğŸ”„ å˜åŒ–å»ºè®®</h3>
        <ul class="variations-list">
          <li v-for="variation in recipeResult.variations" :key="variation">{{ variation }}</li>
        </ul>
  </div>
  </template>
    </section>
  </div>
  
  <script src="./app.js?v=3"></script>
</body>
</html>
